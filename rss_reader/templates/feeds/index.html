{% extends 'base.html' %}
{% load static i18n %}

{% block content %}
  <div id="core-page">
    <template v-if="subscribedFeedsFetched && subscribedFeeds.length == 0">
      <div class="uk-text-center uk-margin-large-top">
        <img src="{% static 'images/newspaper.svg' %}" width="220px" />
        <h2 class="uk-text-bold uk-margin-top uk-margin-remove-bottom">Create your first Feed</h2>
        <p class="uk-margin-small-top">Â¡Start reading your favorite blogs!</p>

        <a class="uk-button uk-button-primary uk-margin-top" href="#add-new-feed-modal" uk-toggle>+ Add a new Feed</a>
      </div>
    </template>

    <template v-else-if="subscribedFeedsFetched">
      <div class="uk-grid uk-child-width-1-1 uk-child-width-1-2@m">
        <subscribed-feeds-section 
          :subscribed-feeds="subscribedFeeds"
          :selected-feed-id="selectedFeed.id"
          v-on:get-feed-posts="selectFeed">
        </subscribed-feeds-section>

        <div class="uk-text-right">
          <a class="uk-button uk-button-primary" href="#add-new-feed-modal" uk-toggle v-show="currentUser">
            + Add a new Feed
          </a>
        </div>
      </div>
      
      <h2 class="uk-margin-medium-top">Latest posts</h2>
      <template v-if="!selectedFeed.posts">
        <p>This Feed has no posts.</p>
      </template>

      <div class="feed-posts-section uk-margin-large-bottom uk-grid-match" uk-grid>
        <feed-post
          class="uk-width-1-2@s uk-width-1-3@m"
          v-for="post in selectedFeed.posts"
          :key="post.id"
          :post="post"
          v-on:read-post="selectPostToRead"
        >
        </feed-post>
      </div>
    </template>

    <read-post-modal
      v-if="selectedPost"
      :post="selectedPost">
    </read-post-modal>

    <new-feed-modal
      v-if="currentUser"
      :current-user-id="currentUser.id"
      v-on:feed:add="addFeed">
    </new-feed-modal>
  </div>
{% endblock content %}

{% block javascript %}
  <script>
    var token = "{{ csrf_token }}";
  </script>
  <script src="{% static 'js/components/newFeedModal.js' %}"></script>
  <script src="{% static 'js/components/subscribedFeedsSection.js' %}"></script>
  <script src="{% static 'js/components/readPostModal.js' %}"></script>
  <script src="{% static 'js/components/feedPost.js' %}"></script>
  <script src="{% static 'js/parents/core.js' %}"></script>
{% endblock javascript %}